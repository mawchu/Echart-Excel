<!doctype html>
<html lang="en">
  <head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <style>
        #main{
            max-width: 960px;
            height:400px;
            margin:0 auto;
        }
        #main canvas{
            width: 100%;
            height:400px;
        }
    </style>
  </head>
  <body>
      <div id="app">
        <div id="main"></div>
      </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    <script src="./echarts/echarts.min.js"></script>
    <script src="./xlsx/xlsx.full.min.js"></script>
    <script>
        let app = new Vue({
            el:'#app',
            data:{
                xData:[],
                yData1:[],
                yData2:[],
                myChart:null
            },
            mounted(){

                let vm = this;
                vm.myChart = echarts.init(document.getElementById('main'));
                //日期轉換
                Date.prototype.format = function(fmt) { 
                        let o = { 
                            "M+" : this.getMonth()+1,                 //月份 
                            "d+" : this.getDate(),                    //日 
                            "h+" : this.getHours(),                   //小时 
                            "m+" : this.getMinutes(),                 //分 
                            "s+" : this.getSeconds(),                 //秒 
                            "q+" : Math.floor((this.getMonth()+3)/3), //季度 
                            "S"  : this.getMilliseconds()             //毫秒 
                        }; 
                        if(/(y+)/.test(fmt)) {
                                fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length)); 
                        }
                        for(let k in o) {
                            if(new RegExp("("+ k +")").test(fmt)){
                                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
                            }
                        }
                        return fmt; 
                    }
                //fetch方法改成axios
                axios.get('./保守型投資組合比股市抗跌.xlsx',{responseType: 'arraybuffer'})
                    .then((res)=>{
                        // console.log(res)
                        if (!res.status === 200) throw new Error("fetch failed");
                        return res.data;
                    })
                    .then((ab)=>{
                        /* parse the data when it is received */
                        let data = new Uint8Array(ab);
                        let workbook = XLSX.read(data, {
                            type: "array"
                        });
                        let first_sheet_name = workbook.SheetNames[0];
                        /* Get worksheet */
                        let worksheet = workbook.Sheets[first_sheet_name];
                        let _JsonData = XLSX.utils.sheet_to_json(worksheet, { raw: true });
                        console.log(_JsonData)
                        //獲得特定位置的欄位的值
                        let cell = worksheet['A1'].v;
                        console.log(cell) 
                        _JsonData.forEach(function(e,i){
                            // console.log(`第${i}個`, e['__EMPTY_2'])
                            if(i > 9){
                                let dateFmt = vm.ExcelDateToJSDate(e['增長']).format("yyyy-MM-dd")
                                vm.xData.push(dateFmt)//抓到日期
                                let data = e['__EMPTY_2'];
                                let data2 = e['__EMPTY_7'];

                                vm.yData1.push(data)//抓到百分比
                                vm.yData2.push(data2)//抓到百分比

                            }
                        })
                        console.log(vm.xData)//百分比array
                        console.log(vm.yData1)//百分比array  

                        vm.drawChart();

                    })

                   
            },
            methods:{
                    ExcelDateToJSDate(date) {
                        return new Date(Math.round((date - 25569)*86400*1000));
                    },
                    drawChart(){
                        // 指定图表的配置项和数据
                        let vm = this;
                        let option = {
                            textStyle:{
                                fontSize:14
                            },
                            title: {
                                text: '投組報酬率模擬'
                            },
                            tooltip: {
                                trigger: 'axis',
                                axisPointer:{
                                    type:'line',
                                },
                                backgroundColor: 'rgba( 29, 94, 105, .8)',
                                lable:{
                                    borderColor:'#16b6d2'
                                },
                                // formatter:'{b}<br />\
                                //                   <span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#5374E9"></span>\
                                //                   {a0}：{c0}<br />\
                                //                   <span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#FFA123"></span>\
                                //                   {a1}：{c1}%<br />\
                                //                   <span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#37C2CF"></span>\
                                //                   {a2}：{c2}%<br />\
                                //                   <span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:#F97979"></span>\
                                //                   {a3}：{c3}%<br />',
                                formatter: function (params) {
                                    var html=params[0].name+"<br>";
                                    for(var i=0;i<params.length;i++){
                                        html+='<span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:'+params[i].color+';"></span>'

                                        html+=params[i].seriesName+" : "+params[i].value+" %<br>";

                                    }
                                    return html;
                                }

                            },
                            legend: {
                                x: 'right',
                                orient: 'vertical',
                                data: ['Alpha 40_old','MSCI World All Cap NR USD']
                            },
                            grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '3%',
                                containLabel: true
                            },
                            toolbox: {
                                feature: {
                                    saveAsImage: {}
                                },
                                x: 'center',
                            },
                            //日期 X軸
                            xAxis: {
                                type: 'category',
                                boundaryGap: false,
                                data: vm.xData,
                                axisLine:{
                                    lineStyle:{
                                        color:'#999'
                                    }
                                },
                                boundaryGap: true,//X軸不從0開始 會保持距離
                                
                            },
                            yAxis: {
                                type: 'value',
                                splitLine: {
                                    lineStyle: {
                                        color: '#eee'//y軸格線顏色
                                    }
                                },
                                axisLine:{
                                    lineStyle:{
                                        color:'#999'
                                    }
                                },
                                axisLabel: {  
                                    show: true,  
                                    interval: 'auto',  
                                    formatter: '{value} %'  
                                }, 
                                
                            },
                            series: [
                                //資料筆數
                                {
                                    name: 'Alpha 40_old',
                                    type: 'line',
                                    // stack: '总量',
                                    data: vm.yData1,
                                    color: ['#16b6d2'],
                                    lineStyle:{
                                        width:2//设置线条粗细
                                    },
                                    showSymbol: false,
                                    
                                },
                                {
                                    name: 'MSCI World All Cap NR USD',
                                    type: 'line',
                                    // stack: '总量',
                                    data: vm.yData2,
                                    color: ['#ff6f80'],
                                    lineStyle:{
                                        width:2//设置线条粗细
                                    },
                                    showSymbol: false,

                                },
                            ]
                            
                        };

                        // 使用刚指定的配置项和数据显示图表。
                        vm.myChart.setOption(option);

                        /*窗口自适应，关键代码*/
                        window.onresize = function () {
                            vm.myChart.resize();
                        }
                        

                    }
                }
        })
    </script>
  </body>
</html>